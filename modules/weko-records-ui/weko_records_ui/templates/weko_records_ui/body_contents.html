{# -*- coding: utf-8 -*-
#
# This file is part of WEKO3.
# Copyright (C) 2017 National Institute of Informatics.
#
# WEKO3 is free software; you can redistribute it
# and/or modify it under the terms of the GNU General Public License as
# published by the Free Software Foundation; either version 2 of the
# License, or (at your option) any later version.
#
# WEKO3 is distributed in the hope that it will be
# useful, but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
# General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with WEKO3; if not, write to the
# Free Software Foundation, Inc., 59 Temple Place, Suite 330, Boston,
# MA 02111-1307, USA.
#}

<div class="panel-group">
<div class="panel panel-default">
  <div class="panel-heading clearfix">
    <h3 class="panel-title">{{_('Index')}}</h3>
  </div>
  <div class="panel-body">
    <pre class="hide">{{record|tojson}}</pre>
    <div class="panel_bread" id="panel_bread">
      {%- if record.navi -%}
        {%- for nav in record.navi -%}
        <ol class="breadcrumb">
          {%- set name = nav.name.split('/') -%}
          {%- set p = nav.path.split('/') -%}
          {%- for n in name -%}
            <li><a href={{url_for("invenio_search_ui.search")+"?search_type=2&q="+p[loop.index-1]}}>{{n}}</a></li>
          {%- endfor -%}
        </ol>
        {%- endfor -%}
      {%- endif -%}
    </div>
  </div>
</div>
<div class="panel panel-default">
  <div class="panel-heading clearfix">
    <h3 class="panel-title">{{_('Item')}}</h3>
  </div>
  <div class="panel-body">
    <div class="panel panel-default">
      <div class="panel-heading">
        <div class="form-inline">
          <a href="#"><span class="glyphicon glyphicon-file" aria-hidden="true"></span> {{ record.get('item_title', _('No title')) }}</a>
        </div>
      </div>
      <div class="panel-body">
        <div class="row">
          <div class="col-sm-9 col-md-9 col-left">
            {%- block record_author %}
              {%- set files = record.files -%}
              {%- set ignore_meta = ('_buckets', '_deposit', '_oai', 'path', 'filemeta', 'item_title', 'item_type_id') -%}
              {%- if files -%}
              <table class="table table-bordered table-striped">
                <thead>
                <tr >
                  <th>{{_('Name')}} / {{_('File')}}</th>
                  <th class="license">{{_('License')}}</th>
                </tr>
                </thead>
                <tbody>
                {%- for file in files|sort(attribute='key') -%}
                {%- set img = file.mimetype | get_image_src -%}
                {%- set file_url = url_for('invenio_records_ui.recid_files', pid_value=pid.pid_value,
                filename=file.key) %}
                <tr >
                  <td >{{file.filename}}</td>
                  <td rowspan="2">
                    {%- if not 'simple' in file.displaytype -%}
                    {%- if 'license_free' == file.licensetype -%}
                      <span class="break-word">{{ file.licensefree }}</span>
                    {%- else %}
                      {% set lst = file.licensetype | get_license_icon %}
                      <a target="_blank" href="{{lst[2]}}" alt="Creative Commons Licenses">
                        <img src="{{lst[0]}}"/></a><br>
                      {{ lst[1] }}
                      {%- endif %}
                    {%- endif -%}
                  </td>
                </tr>
                <tr >
                  <td>
                      <span class="filename">
                        <img src="{{img}}"/>
                        <a class="forcewrap"
                           href="{{file_url}}">{{ file.filename }} ({{ file.size|filesizeformat }})</a>
                        <span>[ 0 downloads ]</span><br>
                        <span>{{file.checksum.split(':')[0]}}</span>
                        <span class="break-word">{{file.checksum.split(':')[1]}}</span>
                      </span>
                  </td>
                </tr>
                {%- if 'detail' in file.displaytype and 'pdf' in file.mimetype -%}
                <tr >
                  <td colspan="2">
                    <div class="panel panel-default" id="preview_de">
                      <div class="panel-heading">
                        <a class="panel-toggle" data-toggle="collapse" href="#{{loop.index}}">
                          {{_('Preview')}}
                          <span class="pull-right show-on-collapsed"><i class="fa fa-chevron-right"></i></span>
                          <span class="pull-right hide-on-collapsed"><i class="fa fa-chevron-down"></i></span>
                        </a>
                      </div>
                      <div id="{{loop.index}}" class="collapse">
                        <div class="embed-responsive embed-responsive-16by9">
                            <iframe class="preview-iframe" id="preview-iframe_de" width="100%" height="400"
                                  src="{{ url_for('invenio_records_ui.recid_preview', pid_value=pid.pid_value, filename=file.key) }}">
                            </iframe>
                        </div>
                      </div>
                    </div>
                  </td>
                </tr>
                {%- endif -%}
                {%- if 'preview' in file.displaytype -%}
                <tr >
                  <td colspan="2">
                    <div class="panel panel-default" id="preview">
                      <div class="panel-heading">
                        <a class="panel-toggle" data-toggle="collapse" href="#{{loop.index}}">
                          {{_('Preview')}}
                          <span class="pull-right show-on-collapsed"><i class="fa fa-chevron-right"></i></span>
                          <span class="pull-right hide-on-collapsed"><i class="fa fa-chevron-down"></i></span>
                        </a>
                      </div>
                      <div id="{{loop.index}}" class="collapse">
                        <div class="embed-responsive embed-responsive-16by9">
                          {%- if 'audio' in file.mimetype -%}
                            <audio controls preload="auto">
                              <source src="{{file_url}}" type="{{file.mimetype}}">
                            </audio>
                          {%- elif 'video' in file.mimetype -%}
                            <video controls>
                              <source src="{{file_url}}" type="{{file.mimetype}}">
                            </video>
                          {%- elif 'text' in file.mimetype -%}
                            <object data="{{file_url}}" type="{{file.mimetype}}"/>
                          {%- else -%}
                            <iframe class="preview-iframe" id="preview-iframe" width="100%" height="400"
                                  src="{{ url_for('invenio_records_ui.recid_preview', pid_value=pid.pid_value, filename=file.key) }}">
                            </iframe>
                          {%- endif -%}
                        </div>
                      </div>
                    </div>
                  </td>
                </tr>
                {%- endif -%}
                {%- endfor -%}
                </tbody>
              </table>
              {%- endif %}
              <table class="table table-bordered table-striped">
                {% if record.item_type_info %}
                  <tr>
                    <th>{{_('item type')}}</th>
                    <td>{{ record.item_type_info }}</td>
                  </tr>
                {% endif %}
                {%- for lst in record.items_show_list %}
                  <tr>
                    <th>{{ lst['attribute_name'] }}</th>
                    <td>
                      <pre class="hide">{{lst|tojson}}</pre>
                      {% if lst['attribute_value'] is string %}
                        {{ lst['attribute_value'] }}
                      {% else %}
                        {%- for key in lst['attribute_value'] %}
                          {{ key }}
                        {% endfor %}
                      {% endif %}
                      {% if lst['attribute_type'] == 'creator' %}
                        {%- for l in lst['attribute_value_mlt'] if l %}
                          {%- for creatorName in l['creatorNames'] if creatorName -%}
                            {%- if 'name' == config['ITEM_SEARCH_FLG'] -%}
                              {%- set q = 'creator='+creatorName['creatorName'] -%}
                            {%- else -%}
                              {%- set q = 'id='+l['weko_id'] -%}
                            {%- endif -%}
                            <a href="{{url_for('invenio_search_ui.search')+'?q=&'+q}}">{{ creatorName['creatorName'] }}</a><label class="p-left-10"></label>
                          {%- endfor -%}
                          <br>
                          {%- for nameIdentifier in l['nameIdentifiers'] if nameIdentifier -%}
                            {%- if nameIdentifier['nameIdentifierURI']|length > 0 -%}
                              {%- set nid = nameIdentifier['nameIdentifierURI'] -%}
                            {%- else -%}
                              {%- set nid = 'http://'+nameIdentifier['nameIdentifierScheme']+'.io/'+ nameIdentifier['nameIdentifier'] -%}
                            {%- endif -%}
                            <label class="p-left-10">{{nameIdentifier['nameIdentifierScheme']}}: </label><a href="{{nid}}">{{ nameIdentifier['nameIdentifier'] }}</a>
                          {%- endfor -%}
                          <br>
                          {%- if config['EMAIL_DISPLAY_FLG'] -%}
                            {%- for creatorMail in l['creatorMails'] if creatorMail -%}
                              <label class="p-left-10">e-mail: </label><a href="{{'mailto:'+creatorMail['creatorMail']}}">{{ creatorMail['creatorMail'] }}</a>
                            {%- endfor -%}
                            <br>
                          {%- endif -%}
                        {% endfor %}
                      {% else %}
                        {%- for l in lst['attribute_value_mlt'] %}
                          {%- for k, v in l.items() %}
                            {{ v }}<br>
                          {% endfor %}
                        {% endfor %}
                      {% endif %}
                    </td>
                  </tr>
                {% endfor %}
                {% if record.pubdate %}
                  <tr>
                    <th>{{_('Publish Status')}}</th>
                    {%- set pubs = record.get('publish_status','1') -%}
                    {% if record.editable %}
                    {%- set dis = '' -%}
                    {% else %}
                    {%- set dis = 'disabled' -%}
                    {% endif %}
                    <td>
                      <div>
                        <form class="form form-inline"
                              action="{{ url_for('invenio_records_ui.recid_publish',
                              pid_value=pid.pid_value) }}"
                              method="POST">
                          {% if record | check_permission %}
                             {% if '0' in pubs %}
                              <button class="btn btn-default" type="submit" name="status" value="1">
                                {{_('Private')}}
                              </button>  {{_('Publish')}}
                             {% else %}
                              <button class="btn btn-default" type="submit" name="status" value="0">
                                {{_('Publish')}}
                              </button>  {{_('Private')}}
                             {% endif %}
                          {% else %}
                              {% if '0' in pubs %}{{_('Publish')}}{% else %}{{_('Private')}}
                          {% endif %}
                          {% endif %}
                        </form>
                      </div>
                    </td>
                  </tr>
                {% endif %}
              </table>
              {%- if 'main_entry_personal_name' in record %}
              <p class="record_authors">
                <i>{{ record['main_entry_personal_name']['personal_name'] }}</i>
                {%- for author in record.get('added_entry_personal_name', []) %}
                , <i>{{ author['personal_name'] }}</i>
                {% endfor %}
              </p>
              {% endif %}
            {%- endblock %}

            <div class="text-center" ng-app="myApp" ng-controller="ItemController">
              <a class="btn btn-default" id="btn_back" href="#" >
                <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>{{_('Back')}}</a>
              {% if record | check_permission %}
              <a class="btn btn-default" id="btn_edit" href="{{ '/item/edit/'+pid.pid_value }}">
                <span class="glyphicon glyphicon-edit" aria-hidden="true"></span>{{_('Edit')}}</a>
              <a class="btn btn-danger btn-sm" id="btn_delete" href="#"
                 ng-click="openConfirm('',
                 '{{'/api/deposits/items/'+pid.pid_value}}',
                 '{{url_for('weko_items_ui.index')}}')">
                <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>{{_('Delete')}}</a>
              <script type="text/ng-template" id="confirm-modal.html">
                <div class="modal-header"><h3 class="modal-title"><span class="glyphicon glyphicon-info-sign"></span>Confirm</h3></div>
                <div class="modal-body">
                  <p>{{ _('Are you sure you want to delete this item?') }}</p>
                </div>
                <div class="modal-footer">
                  <button class="btn btn-primary" ng-click="ok()">{{_('Ok')}}</button>
                  <button class="btn btn-warning" ng-click="cancel()">Cancel</button>
                </div>
              </script>
              {% endif %}
            </div>
          </div>
          <div class="col-sm-3 col-md-3 col-right">
            {%- block record_extra_info %}
            <div class="extra-info">
              <dl>
                {%- if pid %}
                {%- block record_control_number %}
                <!-- 
                <dt>{{ _('Control number') }}</dt>
                <dd>{{ record.get('control_number', pid.value) }}</dd>
                -->
                <!-- demo -->
                <strong>Identifier</strong>
                <span>
		<svg xmlns="http://www.w3.org/2000/svg" width="186" height="20">
        		<linearGradient id="b" x2="0" y2="100%">
            			<stop offset="0" stop-color="#bbb" stop-opacity=".1"/>
            			<stop offset="1" stop-opacity=".1"/>
        		</linearGradient>
        		<mask id="a" width="186" height="20">
            			<rect width="186" height="20" rx="3" fill="#fff"/>
        		</mask>
        		<g mask="url(#a)">
            			<path fill="#555" d="M0 0h31v20H0z" />
            			<path fill="#007ec6" d="M31 0h155v20H31z" />
            			<path fill="url(#b)" d="M0 0h186v20H0z" />
        		</g>
        		<g fill="#fff" text-anchor="middle" font-family="DejaVu Sans, Verdana,Geneva,sans-serif" font-size="11">
            			<text x="16" y="15" fill="#010101" fill-opacity=".3">
                DOI
            			</text>
            			<text x="16" y="14">
                DOI
            			</text>
            <text x="108" y="15" fill="#010101" fill-opacity=".3">
                xx.xxxx/weko.{{ (record.get('control_number', pid.value)).rjust(8, '0')}}
            </text>
            			<text x="108" y="14">
                xx.xxxx/weko.{{ (record.get('control_number', pid.value)).rjust(8,'0')}}
            			</text>
        		</g>
    		</svg>
                </span>
                <!-- demo -->
                {%- endblock %}
                {% endif %}
                {%- if 'publication_distribution_imprint' in record %}
                {%- block record_publication_date %}
                <dt>{{ _('Publication date') }}</dt>
                <dd>{{ record['publication_distribution_imprint'][0]['date_of_publication_distribution'][0] }}</dd>
                {%- endblock %}
                {% endif %}
                {%- if '$schema' in record %}
                {%- block record_schema %}
                <dt>{{ _('Schema') }}</dt>
                <dd>
                  <a target="_blank" href="{{ record['$schema'] }}">
                    {{ record['$schema'] }}
                  </a>
                </dd>
                {%- endblock %}
                {% endif %}
                {%- include "weko_records_ui/export_well.html" %}
              </dl>
            </div><!-- /.extra-info -->
            {%- endblock record_extra_info %}

<!-- start demo block -->
            <div class="well metadata">
    <h4>Versions</h4>
    <table class="table">
      <tbody><tr class="info">
        <td>
          <a href="/record/1313703">Version 1 </a>
          <small class="text-muted">10.5281/zenodo.1313703</small>
        </td>
        <td align="right"><small class="text-muted">May 25, 2018</small></td>
      </tr>
      <tr>
        <td>
          <a href="/record/1254077">Version 1 </a>
          <small class="text-muted">10.5281/zenodo.1254077</small>
        </td>
        <td align="right"><small class="text-muted">May 25, 2018</small></td>
      </tr>
    </tbody></table>
    <small>
      <strong>Cite all versions?</strong> You can cite all versions by using the DOI <a href="https://doi.org/10.5281/zenodo.1254076">10.5281/zenodo.1254076</a>. This DOI represents all versions, and will always resolve to the latest one. <a href="http://help.zenodo.org/#versioning">Read more</a>.
    </small>
  </div>
<div class="well"><h4>Share</h4>
  <!-- AddThis Button BEGIN -->
  <div class="addthis_toolbox addthis_default_style addthis_32x32_style" addthis:url="https://doi.org/xx.xxxx/weko.00000001">
  <a class="addthis_button_mendeley at300b" target="_blank" title="Mendeley" href="#"><span class="at-icon-wrapper" style="background-color: rgb(175, 18, 43); line-height: 32px; height: 32px; width: 32px;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" version="1.1" role="img" aria-labelledby="at-svg-mendeley-1" title="Mendeley" alt="Mendeley" style="width: 32px; height: 32px;" class="at-icon at-icon-mendeley"><title id="at-svg-mendeley-1">Mendeley</title><g><path d="M26.24 18.08c-1.42-.08-1.95-.81-1.86-2.09.07-1.08.27-2.15.4-3.22-.02-1.68-.91-3.02-2.4-3.47-1.53-.45-2.87-.14-3.96 1.11-2.24 2.56-2.53 2.55-4.85-.04-1.11-1.24-2.76-1.6-4.24-.95-1.45.64-2.29 2.16-2.08 3.82.08.6.27 1.19.36 1.8.33 2.05-.1 2.61-2.15 3.04-1.03.22-1.85.76-1.98 1.92-.13 1.18.16 2.31 1.36 2.66.74.22 1.79.08 2.47-.31.93-.53 1.03-1.58.71-2.65-.6-1.98-.03-2.94 2.04-3.23.81-.11 1.7-.02 2.48.23 1.26.4 1.63 1.33 1.13 2.56-.43 1.07-.43 2.02.38 2.89.81.87 2.33 1.05 3.4.42 1.08-.64 1.44-1.75 1.01-3.06-.59-1.75-.08-2.69 1.75-3.02.68-.12 1.41-.11 2.09.02 1.77.35 2.3 1.33 1.78 3.08-.49 1.64.19 2.98 1.66 3.31 1.29.29 2.53-.59 2.79-1.95.27-1.56-.6-2.77-2.29-2.87zM15.89 18a2.463 2.463 0 0 1-2.36-2.48c.01-1.41 1.11-2.48 2.52-2.45 1.41.02 2.48 1.14 2.43 2.54-.04 1.37-1.21 2.44-2.59 2.39z"></path></g></svg></span></a>
  <a class="addthis_button_citeulike at300b" target="_blank" title="CiteULike" href="#"><span class="at-icon-wrapper" style="background-color: rgb(8, 136, 200); line-height: 32px; height: 32px; width: 32px;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" version="1.1" role="img" aria-labelledby="at-svg-citeulike-2" title="CiteULike" alt="CiteULike" style="width: 32px; height: 32px;" class="at-icon at-icon-citeulike"><title id="at-svg-citeulike-2">CiteULike</title><g><path d="M26.41 8.25H4.82a1.25 1.25 0 0 1 0-2.5h21.59a1.25 1.25 0 0 1 0 2.5zM26.41 14.25H4.82a1.25 1.25 0 0 1 0-2.5h21.59a1.25 1.25 0 0 1 0 2.5zM26.41 20.25H4.82a1.25 1.25 0 0 1 0-2.5h21.59a1.25 1.25 0 0 1 0 2.5zM26.41 26.25H4.82a1.25 1.25 0 0 1 0-2.5h21.59a1.25 1.25 0 0 1 0 2.5z"></path></g></svg></span></a>
  <a class="addthis_button_twitter at300b" title="Twitter" href="#"><span class="at-icon-wrapper" style="background-color: rgb(29, 161, 242); line-height: 32px; height: 32px; width: 32px;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" version="1.1" role="img" aria-labelledby="at-svg-twitter-3" title="Twitter" alt="Twitter" style="width: 32px; height: 32px;" class="at-icon at-icon-twitter"><title id="at-svg-twitter-3">Twitter</title><g><path d="M27.996 10.116c-.81.36-1.68.602-2.592.71a4.526 4.526 0 0 0 1.984-2.496 9.037 9.037 0 0 1-2.866 1.095 4.513 4.513 0 0 0-7.69 4.116 12.81 12.81 0 0 1-9.3-4.715 4.49 4.49 0 0 0-.612 2.27 4.51 4.51 0 0 0 2.008 3.755 4.495 4.495 0 0 1-2.044-.564v.057a4.515 4.515 0 0 0 3.62 4.425 4.52 4.52 0 0 1-2.04.077 4.517 4.517 0 0 0 4.217 3.134 9.055 9.055 0 0 1-5.604 1.93A9.18 9.18 0 0 1 6 23.85a12.773 12.773 0 0 0 6.918 2.027c8.3 0 12.84-6.876 12.84-12.84 0-.195-.005-.39-.014-.583a9.172 9.172 0 0 0 2.252-2.336" fill-rule="evenodd"></path></g></svg></span></a>
  <a class="addthis_button_facebook addthis_button_preferred_1 at300b" title="Facebook" href="#"><span class="at-icon-wrapper" style="background-color: rgb(59, 89, 152); line-height: 32px; height: 32px; width: 32px;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" version="1.1" role="img" aria-labelledby="at-svg-facebook-5" title="Facebook" alt="Facebook" style="width: 32px; height: 32px;" class="at-icon at-icon-facebook"><title id="at-svg-facebook-5">Facebook</title><g><path d="M22 5.16c-.406-.054-1.806-.16-3.43-.16-3.4 0-5.733 1.825-5.733 5.17v2.882H9v3.913h3.837V27h4.604V16.965h3.823l.587-3.913h-4.41v-2.5c0-1.123.347-1.903 2.198-1.903H22V5.16z" fill-rule="evenodd"></path></g></svg></span></a>
  <a class="addthis_button_print addthis_button_preferred_2 at300b" title="Print" href="#"><span class="at-icon-wrapper" style="background-color: rgb(115, 138, 141); line-height: 32px; height: 32px; width: 32px;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" version="1.1" role="img" aria-labelledby="at-svg-print-6" title="Print" alt="Print" style="width: 32px; height: 32px;" class="at-icon at-icon-print"><title id="at-svg-print-6">Print</title><g><path d="M24.67 10.62h-2.86V7.49H10.82v3.12H7.95c-.5 0-.9.4-.9.9v7.66h3.77v1.31L15 24.66h6.81v-5.44h3.77v-7.7c-.01-.5-.41-.9-.91-.9zM11.88 8.56h8.86v2.06h-8.86V8.56zm10.98 9.18h-1.05v-2.1h-1.06v7.96H16.4c-1.58 0-.82-3.74-.82-3.74s-3.65.89-3.69-.78v-3.43h-1.06v2.06H9.77v-3.58h13.09v3.61zm.75-4.91c-.4 0-.72-.32-.72-.72s.32-.72.72-.72c.4 0 .72.32.72.72s-.32.72-.72.72zm-4.12 2.96h-6.1v1.06h6.1v-1.06zm-6.11 3.15h6.1v-1.06h-6.1v1.06z"></path></g></svg></span></a>
  <a class="addthis_button_compact at300m" href="#"><span class="at-icon-wrapper" style="background-color: rgb(255, 101, 80); line-height: 32px; height: 32px; width: 32px;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" version="1.1" role="img" aria-labelledby="at-svg-addthis-4" title="More" alt="More" style="width: 32px; height: 32px;" class="at-icon at-icon-addthis"><title id="at-svg-addthis-4">Addthis</title><g><path d="M18 14V8h-4v6H8v4h6v6h4v-6h6v-4h-6z" fill-rule="evenodd"></path></g></svg></span></a>
  <div class="atclear"></div></div>
  <!-- AddThis Button END -->
  <h4>Cite as</h4>
  <div id="invenio-csl" class="ng-scope">
Under construction.  
</div>
      </div>
<!-- end demo block -->
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
</div>
