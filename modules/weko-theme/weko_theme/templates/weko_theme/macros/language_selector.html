{#
# This file is part of WEKO3.
# Copyright (C) 2017 National Institute of Informatics.
#
# WEKO3 is free software; you can redistribute it
# and/or modify it under the terms of the GNU General Public License as
# published by the Free Software Foundation; either version 2 of the
# License, or (at your option) any later version.
#
# WEKO3 is distributed in the hope that it will be
# useful, but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
# General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with WEKO3; if not, write to the
# Free Software Foundation, Inc., 59 Temple Place, Suite 330, Boston,
# MA 02111-1307, USA.
#}

{% macro language_selector_dropdown() %}
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <form id="language-code-form" class="form form-inline lang-select text-white"
        action="{{ url_for('invenio_i18n.set_lang')}}"
        method="POST">
    <div class="form-group">
      <span for="lang-code">{{ _('Language:') }}</span>
      <select class="form-control" id="lang-code" name="lang_code">
        <script>
          const urlLoad = '/api/admin/get_selected_lang';
          $.ajax({
            url: urlLoad,
            type: 'GET',
            success: function (data) {
              console.log(data);
              let options = '';
              if (!data.lang) {
                // Do nothing
              } else {
                if (!data.selected && data.lang[0].lang_code) {
                  data.selected = data.lang[0].lang_code
                }
                const results = data.lang.sort((o1, o2) => {
                  return o1.sequence - o2.sequence;
                });

                for (let index = 0; index < results.length; index++) {
                  const element = results[index];
                  if (element.lang_code == data.selected) {
                    options += `<option value="${element.lang_code}" selected>${element.lang_name}</option>`;
                    continue;
                  }
                  options += `<option value="${element.lang_code}">${element.lang_name}</option>`;
                }
              }
              const select = $('select[id=\'lang-code\']');
              select.children().remove();
              select.append(options);
            },
            error: function (error) {
              console.log(error);
            }
          });
        </script>
      </select>
    </div>
  </form>
{% endmacro %}
