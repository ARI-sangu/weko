(this["webpackJsonpweko-facet-search"]=this["webpackJsonpweko-facet-search"]||[]).push([[0],{46:function(e,t,a){},72:function(e,t,a){"use strict";a.r(t);var n=a(0),c=a.n(n),s=a(14),r=a.n(s),l=a(9),o=a(10),i=a(5),u=a(11),d=a(15),h=(a(18),a(19),a(46),a(30)),m=a(6),b=a(74),g=a(41),j=a(4);var v=function(e){var t=e.values,a=e.name,n=e.labels,c=new URLSearchParams(null!=sessionStorage.getItem("weko_search_param")?sessionStorage.getItem("weko_search_param"):window.location.search),s=[],r=[];return t&&t.map((function(e,t){var l={label:(n[e.key]||e.key)+"("+e.doc_count+")",value:e.key};r.push(l),c.get(a)&&c.getAll(a).includes(e.key)&&s.push(l)})),Object(j.jsx)("div",{children:Object(j.jsx)("div",{className:"select-container",children:Object(j.jsx)(g.a,{defaultValue:s,isMulti:!0,name:"Facet_Search",ontrolShouldRenderValue:!1,onChange:function(e){var t;t=e,c.delete(a),t.map((function(e,t){c.append(a,e.value)})),"0"===c.get("q")&&c.set("q",""),c.set("is_facet_search","true"),console.log("============ PARAM :"+c.toString()),sessionStorage.setItem("weko_search_param",c.toString()),window.invenioSearchFunctions.reSearchInvenio()},backspaceRemovesValue:!1,isClearable:!1,options:r,className:"basic-multi-select",classNamePrefix:"select"})})})},p=a(40);var f=function(e){var t=e.value,a=e.name,c=(e.labels,"id_"+a+"_slider");CSS.escape(c);var s=new URLSearchParams(null!=sessionStorage.getItem("weko_search_param")?sessionStorage.getItem("weko_search_param"):window.location.search),r=null==s.get("date_range1_from")?null:parseInt(s.get("date_range1_from")),l=null==s.get("date_range1_to")?null:parseInt(s.get("date_range1_to"));t&&null==r&&null==l&&t.map((function(e,t){var a;e.key.length>0&&(a=parseInt(e.key),(null==r||r>a)&&(r=a),(null==l||l<a)&&(l=a))}));var o=(l-r)/100,i=Object(n.useState)([r,l]),u=Object(m.a)(i,2),d=u[0],h=u[1],b=Object(n.useState)(r),g=Object(m.a)(b,2),v=g[0],f=g[1],_=Object(n.useState)(l),O=Object(m.a)(_,2),y=O[0],k=O[1],x=Object(n.useState)("form-control"),S=Object(m.a)(x,2),w=S[0],N=S[1],I=Object(n.useState)("form-control"),C=Object(m.a)(I,2),A=C[0],F=C[1],q=Object(n.useState)(""),E=Object(m.a)(q,2),R=E[0],T=E[1];return window.facetSearchFunctions[a+"_clearSliderValue"]=function(){h([r,l]),f(r),k(l),N("form-control"),F("form-control"),T("")},Object(j.jsxs)("div",{id:c,children:[Object(j.jsx)("div",{className:"col-sm-11",style:{paddingBottom:"20px","white-space":"nowrap"},children:Object(j.jsx)(p.a.Range,{min:r,max:l,step:o,onChange:function(e){h([e[0],e[1]]),v!=e[0]&&f(Math.round(e[0])),y!=e[1]&&k(Math.round(e[1]))},defaultValue:d,value:d})}),Object(j.jsxs)("div",{className:"form-group row",children:[Object(j.jsx)("div",{className:"col-sm-5",children:Object(j.jsx)("input",{type:"number",id:c+"_input_head",className:w,value:v,onChange:function(e){return f(e.target.value)}})}),Object(j.jsx)("div",{className:"col-sm-5",children:Object(j.jsx)("input",{type:"number",id:c+"_input_tail",className:A,value:y,onChange:function(e){return k(e.target.value)}})}),Object(j.jsx)("div",{className:"col-sm-2",children:Object(j.jsx)("button",{type:"button",style:{marginLeft:"3px"},className:"btn btn-primary pull-right",onClick:function(){(function(){var e=document.getElementById(c+"_input_head"),t=document.getElementById(c+"_input_tail");if(document.getElementById(c+"_msg"),!e.value||!t.value)return e.value||N("form-control range-slider-error"),t.value||F("form-control range-slider-error"),T("Set the value."),!1;var a=new RegExp(/^([1-9]\d*|0)$/),n=a.exec(v),s=a.exec(y);return null==n||n[0]!=v||null==s||s[0]!=y?(null!=n&&n[0]==v||N("form-control range-slider-error"),null!=s&&s[0]==y||F("form-control range-slider-error"),T("Set the correct value."),!1):parseFloat(v)>parseFloat(y)?(N("form-control range-slider-error"),F("form-control range-slider-error"),T("The range from should be less than or equal to the range to."),!1):(N("form-control"),F("form-control"),T(""),!0)})()&&(s.set("date_range1_from",v),s.set("date_range1_to",y),"0"===s.get("q")&&s.set("q",""),s.set("is_facet_search","true"),sessionStorage.setItem("weko_search_param",s.toString()),window.invenioSearchFunctions.reSearchInvenio())},children:" \u691c\u7d22"})})]}),Object(j.jsx)("div",{className:"range-slider-error-msg",id:c+"_msg",children:R})]})},_=a(1),O=a(2);var y=function(e){var t=e.values,a=e.name,c=e.labels,s=e.displayNumber,r=Object(n.useState)({}),l=Object(m.a)(r,2),o=l[0],i=l[1],u="id_"+a+"_chkbox",d=CSS.escape(u),h=function(e){var t=e.id,a=e.value,n=e.checked,c=e.onChange;return null!=c?(o[t]=n,Object(j.jsx)("input",{id:t,className:"facet-chbox",type:"checkbox",checked:o[t],onChange:c,value:a})):Object(j.jsx)("input",{id:t,className:"facet-chbox",type:"checkbox",defaultChecked:n,value:a})},b=function(e){var t=e.values,a=e.name,n=e.isModal,c=e.displayNumber,s=e.onChange;return t.map((function(e,t){if(n||t<c){var r="id_"+a+(n?"_chkbox_mdl_":"_chkbox_")+t,l=e.key+"("+e.doc_count+")",o=y.get(a)&&y.getAll(a).includes(e.key);return Object(j.jsx)("div",{children:Object(j.jsxs)("label",{htmlFor:r,children:[Object(j.jsx)(h,{id:r,value:e.key,checked:o,onChange:s},r),l]})},r)}}))},g=function(e){var t=e.values,a=e.name,n=e.modalId;return Object(j.jsxs)("div",{className:"chbox-mdl",id:n,children:[Object(j.jsx)("a",{href:"#!",className:"overlay",onClick:v,modalId:n}),Object(j.jsx)("div",{className:"window",children:Object(j.jsxs)("div",{className:"content",children:[Object(j.jsx)("div",{className:"list",children:Object(j.jsx)(b,{values:t,name:a,isModal:!0})}),Object(j.jsxs)("div",{className:"footer",children:[Object(j.jsx)("a",{href:"#!",onClick:v,modalId:n,children:c.cancel}),Object(j.jsx)("button",{type:"button",className:"btn btn-primary",onClick:p,modalId:n,children:c.search})]})]})})]},n)};function v(e){null!=e&&document.getElementById(e.target.getAttribute("modalId")).classList.remove("is-active")}function p(e){var t=[];document.querySelector("#"+d).querySelectorAll(".chbox-mdl input").forEach((function(e){e.checked?t.push({label:a,value:e.value}):o[e.id]&&i(Object(O.a)(Object(O.a)({},o),{},Object(_.a)({},e.id,e.checked)))})),f(t),document.getElementById(e.target.getAttribute("modalId")).classList.remove("is-active")}function f(e){y.delete(a),e.map((function(e,t){y.append(a,e.value)})),"0"===y.get("q")&&y.set("q",""),y.set("is_facet_search","true"),console.log("============ PARAM :"+y.toString()),sessionStorage.setItem("weko_search_param",y.toString()),window.invenioSearchFunctions.reSearchInvenio()}var y=new URLSearchParams(null!=sessionStorage.getItem("weko_search_param")?sessionStorage.getItem("weko_search_param"):window.location.search),k="id_"+a+"_checkbox_modal",x=null==s?5:s;return Object(j.jsx)("div",{id:u,children:Object(j.jsxs)("div",{className:"chbox-container",children:[Object(j.jsx)(b,{values:t,name:a,isModal:!1,displayNumber:x,onChange:function(e){var t=[];document.querySelector("#"+d).querySelectorAll(".chbox-mdl input").forEach((function(n){(n.checked&&e.target.value!==n.value||e.target.checked&&e.target.value===n.value)&&t.push({label:a,value:n.value})})),i(Object(O.a)(Object(O.a)({},o),{},Object(_.a)({},e.target.id,e.target.checked))),f(t)}}),t.length>x&&Object(j.jsx)("a",{onClick:function(e){null!=e?(document.getElementById(e.target.getAttribute("modalId")).classList.add("is-active"),document.querySelector("#"+d).querySelectorAll(".chbox-mdl input").forEach((function(e){e.checked=y.get(a)&&y.getAll(a).includes(e.value)}))):console.log("event == null")},modalId:k,children:". . . See More"}),Object(j.jsx)(g,{values:t,name:a,modalId:k,displayNumber:s})]})})};for(var k,x=function(e){var t=e.item,a=e.nameshow,c=e.name,s=e.key,r=e.labels,l=e.isInitOpen,o=e.uiType,i=e.displayNumber;console.debug("RangeFacet\u5b9f\u884c");var u=window.location.search.replace(",","%2C").indexOf(encodeURIComponent(c))>=0||l,d=Object(n.useState)(u),h=Object(m.a)(d,2),g=h[0],p=h[1];return Object(j.jsxs)("div",{className:"panel panel-default",children:[Object(j.jsxs)("div",{className:"panel-heading clearfix",children:[Object(j.jsx)("h3",{className:"panel-title pull-left",children:a}),Object(j.jsxs)("a",{className:"pull-right",onClick:function(){return p(!g)},children:[!g&&Object(j.jsx)("span",{children:Object(j.jsx)("i",{className:"glyphicon glyphicon-chevron-right"})}),g&&Object(j.jsx)("span",{children:Object(j.jsx)("i",{className:"glyphicon glyphicon-chevron-down"})})]})]}),Object(j.jsx)(b.a,{isOpen:g,children:Object(j.jsxs)("div",{className:"panel-body index-body",children:[null!=t&&"SelectBox"===o&&Object(j.jsx)(v,{values:t.buckets,name:c,labels:r}),null!=t&&"CheckboxList"===o&&Object(j.jsx)(y,{values:t.buckets,name:c,labels:r,displayNumber:i}),null!=t&&"RangeSlider"===o&&Object(j.jsx)(f,{value:t.buckets,name:c,labels:r})]})})]},s)},S={},w=document.getElementsByClassName("body-facet-search-label"),N=0;N<w.length;N++)S[w[N].id]=w[N].value;var I=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).state={is_enable:!1,list_title:{},list_facet:{},list_order:{},list_uiType:{},list_isOpen:{},list_displayNumber:{}},sessionStorage.removeItem("weko_search_param"),n.getTitleAndOrder=n.getTitleAndOrder.bind(Object(i.a)(n)),n.get_facet_search_list=n.get_facet_search_list.bind(Object(i.a)(n)),n.convertData=n.convertData.bind(Object(i.a)(n)),k=Object(i.a)(n),n}return Object(o.a)(a,[{key:"getTitleAndOrder",value:function(){var e=this,t={},a={},n={},c={},s={};Object(h.a)("/facet-search/get-title-and-order",{method:"POST"}).then((function(e){return e.json()})).then((function(r){r.status&&(t=r.data.titles,a=r.data.order,n=r.data.uiTypes,c=r.data.isOpens,s=r.data.displayNumbers),e.setState({list_title:t}),e.setState({list_order:a}),e.setState({list_uiType:n}),e.setState({list_isOpen:c}),e.setState({list_displayNumber:s}),e.setState({is_enable:!0})}))}},{key:"get_facet_search_list",value:function(){var e=this;"/"===window.location.pathname&&sessionStorage.removeItem("weko_search_param");var t=new URLSearchParams(null!=sessionStorage.getItem("weko_search_param")?sessionStorage.getItem("weko_search_param"):window.location.search),a=2==t.get("search_type")?"/api/index/":"/api/records/";Object(h.a)(a+"?"+t.toString()).then((function(e){return e.json()})).then((function(a){if(2==t.get("search_type")){var n=a&&a.aggregations&&a.aggregations.aggregations?a.aggregations.aggregations[0]:{};e.convertData(n)}else e.convertData(a&&a.aggregations?a.aggregations:{})}))}},{key:"convertData",value:function(e){var t={};e&&Object.keys(e).map((function(a,n){var c=e[a][a]?e[a][a]:e[a],s=c.key&&c.key.hasOwnProperty("buckets");if(s=c.hasOwnProperty("buckets")||s){if(t[a]=c[a]?c[a]:c,"Time Period(s)"!=a&&"Data Language"!=a&&"Access"!=a)for(var r=document.getElementById("lang-code"),l=r.options[r.selectedIndex].value,o=t[a],i=0;i<o.buckets.length;i++){var u=o.buckets[i];("en"==l&&(u.key.charCodeAt(0)>256||u.key.charCodeAt(u.key.length-1)>256)||"en"!=l&&u.key.charCodeAt(0)<256&&u.key.charCodeAt(u.key.length-1)<256)&&(t[a].buckets.splice(i,1),i--)}if("Access"==a)for(var d=t[a],h=0;h<d.buckets.length;h++){var m=d.buckets[h];(m.key.charCodeAt(0)>256||m.key.charCodeAt(m.key.length-1)>256)&&(t[a].buckets.splice(h,1),h--)}}})),this.setState({list_facet:t}),Object.keys(e).map((function(e,t){window.facetSearchFunctions[e+"_clearSliderValue"]&&window.facetSearchFunctions[e+"_clearSliderValue"]()}))}},{key:"componentDidMount",value:function(){this.getTitleAndOrder(),this.get_facet_search_list()}},{key:"render",value:function(){var e=this.state,t=e.is_enable,a=e.list_title,n=e.list_facet,c=e.list_order,s=e.list_uiType,r=e.list_isOpen,l=e.list_displayNumber;return Object(j.jsx)("div",{children:t&&Object(j.jsx)("div",{className:"facet-search break-word",children:Object.keys(c).map((function(e,t){var o=c[e],i=n[o],u=a[o],d=r[o],h=s[o],m=l[o];return Object(j.jsx)(x,{item:i,nameshow:u,name:o,labels:S,isInitOpen:d,uiType:h,displayNumber:m},t)}))})})}}]),a}(c.a.Component);window.facetSearchFunctions={},window.facetSearchFunctions.useFacetSearch=function(){return null!=k},window.facetSearchFunctions.resetFacetData=function(e){null!=k&&k.convertData(e)};var C=I;r.a.render(Object(j.jsx)(c.a.StrictMode,{children:Object(j.jsx)(C,{})}),document.getElementById("app-facet-search"))}},[[72,1,2]]]);
//# sourceMappingURL=main.13911b1b.chunk.js.map