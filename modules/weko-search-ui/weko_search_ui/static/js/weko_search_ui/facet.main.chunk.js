(this["webpackJsonpweko-facet-search"]=this["webpackJsonpweko-facet-search"]||[]).push([[0],{46:function(e,t,a){},72:function(e,t,a){"use strict";a.r(t);var n=a(0),c=a.n(n),r=a(14),l=a.n(r),o=a(9),s=a(10),i=a(5),d=a(11),u=a(15),h=(a(18),a(19),a(46),a(30)),b=a(6),m=a(74),v=a(41),f=a(4);var j=function(e){for(var t=e.values,a=e.name,n=e.labels,c=window.location.search.replace(",","%2C")||"?",r=window.location.search.substring(1).split("&"),l=0;l<r.length;l++)r[l]=decodeURIComponent(r[l]);var o=[],s=[];return t&&t.map((function(e,t){var c={label:(n[e.key]||e.key)+"("+e.doc_count+")",value:e.key};s.push(c);var l=a+"="+e.key;-1!=r.indexOf(l)&&o.push(c)})),Object(f.jsx)("div",{children:Object(f.jsx)("div",{className:"select-container",children:Object(f.jsx)(v.a,{defaultValue:o,isMulti:!0,name:"Facet_Search",ontrolShouldRenderValue:!1,onChange:function(e){!function(e){var t="";if(c.indexOf("&")>=0){for(var n=c.split("&"),r=0;r<n.length;r++)n[r].indexOf(encodeURIComponent(a)+"=")<0&&(t+="&"+n[r]);t=t.substring(1)}""!=t&&(c=t),e.map((function(e,t){var n=encodeURIComponent(a)+"="+encodeURIComponent(e.value);c+="&"+n})),c=c.replace("q=0","q="),c+=-1==c.indexOf("is_facet_search=")?"&is_facet_search=true":"",window.invenioSearchFunctions?(window.history.pushState(null,document.title,"/search"+c),window.invenioSearchFunctions.reSearchInvenio()):window.location.href="/search"+c}(e)},backspaceRemovesValue:!1,isClearable:!1,options:s,className:"basic-multi-select",classNamePrefix:"select"})})})},g=a(40);var p=function(e){var t=e.value,a=e.name,c=(e.labels,"id_"+a+"_slider");CSS.escape(c);var r=window.location.search.replace(",","%2C")||"?",l=new URL(document.location).searchParams,o=null==l.get("date_range1_from")?null:parseInt(l.get("date_range1_from")),s=null==l.get("date_range1_to")?null:parseInt(l.get("date_range1_to"));t&&null==o&&null==s&&t.map((function(e,t){var a;e.key.length>0&&(a=parseInt(e.key),(null==o||o>a)&&(o=a),(null==s||s<a)&&(s=a))}));var i=(s-o)/100;console.log("====== SLIEDER DEBUG   START ======");var d=Object(n.useState)([o,s]),u=Object(b.a)(d,2),h=u[0],m=u[1],v=Object(n.useState)(o),j=Object(b.a)(v,2),p=j[0],O=j[1],_=Object(n.useState)(s),x=Object(b.a)(_,2),y=x[0],k=x[1],w=Object(n.useState)("form-control"),S=Object(b.a)(w,2),C=S[0],I=S[1],N=Object(n.useState)("form-control"),R=Object(b.a)(N,2),F=R[0],A=R[1],U=Object(n.useState)(""),E=Object(b.a)(U,2),T=E[0],B=E[1];return window.facetSearchFunctions[a+"_clearSliderValue"]=function(){m([o,s]),O(o),k(s),I("form-control"),A("form-control"),B("")},Object(f.jsxs)("div",{id:c,children:[Object(f.jsx)("div",{className:"col-sm-11",style:{paddingBottom:"20px","white-space":"nowrap"},children:Object(f.jsx)(g.a.Range,{min:o,max:s,step:i,onChange:function(e){m([e[0],e[1]]),p!=e[0]&&O(Math.round(e[0])),y!=e[1]&&k(Math.round(e[1]))},defaultValue:h,value:h})}),Object(f.jsxs)("div",{className:"form-group row",children:[Object(f.jsx)("div",{className:"col-sm-5",children:Object(f.jsx)("input",{type:"number",id:c+"_input_head",className:C,value:p,onChange:function(e){return O(e.target.value)}})}),Object(f.jsx)("div",{className:"col-sm-5",children:Object(f.jsx)("input",{type:"number",id:c+"_input_tail",className:F,value:y,onChange:function(e){return k(e.target.value)}})}),Object(f.jsx)("div",{className:"col-sm-2",children:Object(f.jsx)("button",{type:"button",style:{marginLeft:"3px"},className:"btn btn-primary pull-right",onClick:function(){if(function(){var e="";if(r.indexOf("&")>=0){var t=r.split("&");console.log(t);for(var a=0;a<t.length;a++)t[a].indexOf(encodeURIComponent("date_range1_from")+"=")<0&&t[a].indexOf(encodeURIComponent("date_range1_to")+"=")<0&&(e+="&"+t[a]);e=e.substring(1)}""!=e&&(r=e)}(),function(){var e=document.getElementById(c+"_input_head"),t=document.getElementById(c+"_input_tail");if(document.getElementById(c+"_msg"),!e.value||!t.value)return e.value||I("form-control range-slider-error"),t.value||A("form-control range-slider-error"),B("Set the value."),!1;var a=new RegExp(/^([1-9]\d*|0)$/),n=a.exec(p),r=a.exec(y);return null==n||n[0]!=p||null==r||r[0]!=y?(null!=n&&n[0]==p||I("form-control range-slider-error"),null!=r&&r[0]==y||A("form-control range-slider-error"),B("Set the correct value."),!1):parseFloat(p)>parseFloat(y)?(I("form-control range-slider-error"),A("form-control range-slider-error"),B("The range from should be less than or equal to the range to."),!1):(I("form-control"),A("form-control"),B(""),!0)}()){var e="";e+="&"+encodeURIComponent("date_range1_from")+"="+encodeURIComponent(p),e+="&"+encodeURIComponent("date_range1_to")+"="+encodeURIComponent(y),r+=e,window.invenioSearchFunctions?(window.history.pushState(null,document.title,"/search"+r),window.invenioSearchFunctions.reSearchInvenio()):window.location.href="/search"+r}},children:" \u691c\u7d22"})})]}),Object(f.jsx)("div",{className:"range-slider-error-msg",id:c+"_msg",children:T})]})},O=a(1),_=a(2);var x=function(e){var t=e.values,a=e.name,c=e.labels,r=e.displayNumber,l=Object(n.useState)({}),o=Object(b.a)(l,2),s=o[0],i=o[1],d="id_"+a+"_chkbox",u=CSS.escape(d),h=function(e){var t=e.id,a=e.value,n=e.checked,c=e.onChange;return null!=c?(s[t]=n,Object(f.jsx)("input",{id:t,className:"facet-chbox",type:"checkbox",checked:s[t],onChange:c,value:a})):Object(f.jsx)("input",{id:t,className:"facet-chbox",type:"checkbox",defaultChecked:n,value:a})},m=function(e){var t=e.values,a=e.name,n=e.isModal,c=e.displayNumber,r=e.onChange;return t.map((function(e,t){if(n||t<c){var l="id_"+a+(n?"_chkbox_mdl_":"_chkbox_")+t,o=e.key+"("+e.doc_count+")",s=-1!=y.indexOf(a+"="+e.key);return Object(f.jsx)("div",{children:Object(f.jsxs)("label",{htmlFor:l,children:[Object(f.jsx)(h,{id:l,value:e.key,checked:s,onChange:r},l),o]})},l)}}))},v=function(e){var t=e.values,a=e.name,n=e.modalId;return Object(f.jsxs)("div",{className:"chbox-mdl",id:n,children:[Object(f.jsx)("a",{href:"#!",className:"overlay",onClick:j,modalId:n}),Object(f.jsx)("div",{className:"window",children:Object(f.jsxs)("div",{className:"content",children:[Object(f.jsx)("div",{className:"list",children:Object(f.jsx)(m,{values:t,name:a,isModal:!0})}),Object(f.jsxs)("div",{className:"footer",children:[Object(f.jsx)("a",{href:"#!",onClick:j,modalId:n,children:c.cancel}),Object(f.jsx)("button",{type:"button",className:"btn btn-primary",onClick:g,modalId:n,children:c.search})]})]})})]},n)};function j(e){null!=e&&document.getElementById(e.target.getAttribute("modalId")).classList.remove("is-active")}function g(e){var t=[];document.querySelector("#"+u).querySelectorAll(".chbox-mdl input").forEach((function(n){n.checked?t.push({label:a,value:n.value}):s[n.id]&&i(Object(_.a)(Object(_.a)({},s),{},Object(O.a)({},e.target.id,n.checked)))})),p(t),document.getElementById(e.target.getAttribute("modalId")).classList.remove("is-active")}function p(e){var t="";if(x.indexOf("&")>=0){for(var n=x.split("&"),c=0;c<n.length;c++)n[c].indexOf(encodeURIComponent(a)+"=")<0&&(t+="&"+n[c]);t=t.substring(1)}""!=t&&(x=t),e.map((function(e,t){var n=encodeURIComponent(a)+"="+encodeURIComponent(e.value);x+="&"+n})),x=x.replace("q=0","q="),x+=-1==x.indexOf("is_facet_search=")?"&is_facet_search=true":"",window.invenioSearchFunctions?(window.history.pushState(null,document.title,"/search"+x),window.invenioSearchFunctions.reSearchInvenio()):window.location.href="/search"+x}for(var x=window.location.search.replace(",","%2C")||"?",y=window.location.search.substring(1).split("&"),k=0;k<y.length;k++)y[k]=decodeURIComponent(y[k]);var w="id_"+a+"_checkbox_modal",S=null==r?5:r;return Object(f.jsx)("div",{id:d,children:Object(f.jsxs)("div",{className:"chbox-container",children:[Object(f.jsx)(m,{values:t,name:a,isModal:!1,displayNumber:S,onChange:function(e){var t=[];document.querySelector("#"+u).querySelectorAll(".chbox-mdl input").forEach((function(n){(n.checked&&e.target.value!==n.value||e.target.checked&&e.target.value===n.value)&&t.push({label:a,value:n.value})})),i(Object(_.a)(Object(_.a)({},s),{},Object(O.a)({},e.target.id,e.target.checked))),p(t)}}),t.length>S&&Object(f.jsx)("a",{onClick:function(e){null!=e?(document.getElementById(e.target.getAttribute("modalId")).classList.add("is-active"),document.querySelector("#"+u).querySelectorAll(".chbox-mdl input").forEach((function(e){e.checked=-1!=y.indexOf(a+"="+e.value)}))):console.log("event == null")},modalId:w,children:". . . See More"}),Object(f.jsx)(v,{values:t,name:a,modalId:w,displayNumber:r})]})})};for(var y,k=function(e){var t=e.item,a=e.nameshow,c=e.name,r=e.key,l=e.labels,o=e.isInitOpen,s=e.uiType,i=e.displayNumber;console.debug("RangeFacet\u5b9f\u884c");var d=window.location.search.replace(",","%2C").indexOf(encodeURIComponent(c))>=0||o,u=Object(n.useState)(d),h=Object(b.a)(u,2),v=h[0],g=h[1];return Object(f.jsxs)("div",{className:"panel panel-default",children:[Object(f.jsxs)("div",{className:"panel-heading clearfix",children:[Object(f.jsx)("h3",{className:"panel-title pull-left",children:a}),Object(f.jsxs)("a",{className:"pull-right",onClick:function(){return g(!v)},children:[!v&&Object(f.jsx)("span",{children:Object(f.jsx)("i",{className:"glyphicon glyphicon-chevron-right"})}),v&&Object(f.jsx)("span",{children:Object(f.jsx)("i",{className:"glyphicon glyphicon-chevron-down"})})]})]}),Object(f.jsx)(m.a,{isOpen:v,children:Object(f.jsxs)("div",{className:"panel-body index-body",children:[null!=t&&"SelectBox"===s&&Object(f.jsx)(j,{values:t.buckets,name:c,labels:l}),null!=t&&"CheckboxList"===s&&Object(f.jsx)(x,{values:t.buckets,name:c,labels:l,displayNumber:i}),null!=t&&"RangeSlider"===s&&Object(f.jsx)(p,{value:t.buckets,name:c,labels:l})]})})]},r)},w={},S=document.getElementsByClassName("body-facet-search-label"),C=0;C<S.length;C++)w[S[C].id]=S[C].value;var I=function(e){Object(d.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={is_enable:!1,list_title:{},list_facet:{},list_order:{},list_uiType:{},list_isOpen:{},list_displayNumber:{}},n.getTitleAndOrder=n.getTitleAndOrder.bind(Object(i.a)(n)),n.get_facet_search_list=n.get_facet_search_list.bind(Object(i.a)(n)),n.convertData=n.convertData.bind(Object(i.a)(n)),y=Object(i.a)(n),n}return Object(s.a)(a,[{key:"getTitleAndOrder",value:function(){var e=this,t={},a={},n={},c={},r={};Object(h.a)("/facet-search/get-title-and-order",{method:"POST"}).then((function(e){return e.json()})).then((function(l){l.status&&(t=l.data.titles,a=l.data.order,n=l.data.uiTypes,c=l.data.isOpens,r=l.data.displayNumbers),e.setState({list_title:t}),e.setState({list_order:a}),e.setState({list_uiType:n}),e.setState({list_isOpen:c}),e.setState({list_displayNumber:r}),e.setState({is_enable:!0})}))}},{key:"get_facet_search_list",value:function(){var e=this;console.debug("get_facet_search_list\u5b9f\u884c");var t=new URLSearchParams(window.location.search),a=2==t.get("search_type")?"/api/index/":"/api/records/";Object(h.a)(a+"?"+t.toString()).then((function(e){return e.json()})).then((function(a){if(2==t.get("search_type")){var n=a&&a.aggregations&&a.aggregations.aggregations?a.aggregations.aggregations[0]:{};e.convertData(n)}else e.convertData(a&&a.aggregations?a.aggregations:{})}))}},{key:"convertData",value:function(e){console.debug("convertData\u5b9f\u884c");var t={};e&&Object.keys(e).map((function(a,n){var c=e[a][a]?e[a][a]:e[a],r=c.key&&c.key.hasOwnProperty("buckets");if(r=c.hasOwnProperty("buckets")||r){if(t[a]=c[a]?c[a]:c,"Time Period(s)"!=a&&"Data Language"!=a&&"Access"!=a)for(var l=document.getElementById("lang-code"),o=l.options[l.selectedIndex].value,s=t[a],i=0;i<s.buckets.length;i++){var d=s.buckets[i];("en"==o&&(d.key.charCodeAt(0)>256||d.key.charCodeAt(d.key.length-1)>256)||"en"!=o&&d.key.charCodeAt(0)<256&&d.key.charCodeAt(d.key.length-1)<256)&&(t[a].buckets.splice(i,1),i--)}if("Access"==a)for(var u=t[a],h=0;h<u.buckets.length;h++){var b=u.buckets[h];(b.key.charCodeAt(0)>256||b.key.charCodeAt(b.key.length-1)>256)&&(t[a].buckets.splice(h,1),h--)}}})),this.setState({list_facet:t}),Object.keys(e).map((function(e,t){window.facetSearchFunctions[e+"_clearSliderValue"]&&window.facetSearchFunctions[e+"_clearSliderValue"]()}))}},{key:"componentDidMount",value:function(){this.getTitleAndOrder(),this.get_facet_search_list()}},{key:"render",value:function(){var e=this.state,t=e.is_enable,a=e.list_title,n=e.list_facet,c=e.list_order,r=e.list_uiType,l=e.list_isOpen,o=e.list_displayNumber;return Object(f.jsx)("div",{children:t&&Object(f.jsx)("div",{className:"facet-search break-word",children:Object.keys(c).map((function(e,t){var s=c[e],i=n[s],d=a[s],u=l[s],h=r[s],b=o[s];return Object(f.jsx)(k,{item:i,nameshow:d,name:s,labels:w,isInitOpen:u,uiType:h,displayNumber:b},t)}))})})}}]),a}(c.a.Component);window.facetSearchFunctions={},window.facetSearchFunctions.useFacetSearch=function(){return null!=y},window.facetSearchFunctions.resetFacetData=function(){console.debug("resetFacetData \u547c\u3073\u51fa\u3055\u308c\u307e\u3057\u305f\u3002"),null!=y&&(console.debug("facetSearchComponent != null \u2192 true"),y.get_facet_search_list())};var N=I;l.a.render(Object(f.jsx)(c.a.StrictMode,{children:Object(f.jsx)(N,{})}),document.getElementById("app-facet-search"))}},[[72,1,2]]]);
//# sourceMappingURL=main.e455d67c.chunk.js.map