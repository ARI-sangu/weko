(this["webpackJsonpweko-facet-search"]=this["webpackJsonpweko-facet-search"]||[]).push([[0],{46:function(e,t,a){},72:function(e,t,a){"use strict";a.r(t);var n=a(0),c=a.n(n),l=a(14),s=a.n(l),r=a(9),i=a(10),o=a(5),u=a(11),d=a(15),h=(a(18),a(19),a(46),a(30)),b=a(6),m=a(74),j=a(41),v=a(4);var g=function(e){var t=e.values,a=e.name,n=e.labels,c=new URLSearchParams(window.location.search),l=[],s=[];return t&&t.map((function(e,t){var r={label:(n[e.key]||e.key)+"("+e.doc_count+")",value:e.key};s.push(r),c.get(a)&&c.getAll(a).includes(e.key)&&l.push(r)})),Object(v.jsx)("div",{children:Object(v.jsx)("div",{className:"select-container",children:Object(v.jsx)(j.a,{defaultValue:l,isMulti:!0,name:"Facet_Search",ontrolShouldRenderValue:!1,onChange:function(e){var t;t=e,c.delete(a),t.map((function(e,t){c.append(a,e.value)})),"0"===c.get("q")&&c.set("q",""),c.set("is_facet_search","true"),console.log("============ PARAM :"+c.toString()),window.invenioSearchFunctions.reSearchInvenio(c)},backspaceRemovesValue:!1,isClearable:!1,options:s,className:"basic-multi-select",classNamePrefix:"select"})})})},p=a(40);var f=function(e){var t=e.value,a=e.name,c=(e.labels,"id_"+a+"_slider");CSS.escape(c);var l=new URLSearchParams(window.location.search),s=null,r=null;if(null!=l.get(a)){var i=l.get(a).split("--");s=parseInt(i[0]),r=parseInt(i[1])}else t&&t.map((function(e,t){var a;e.key.length>0&&(a=parseInt(e.key),(null==s||s>a)&&(s=a),(null==r||r<a)&&(r=a))}));var o=(r-s)/100,u=Object(n.useState)([s,r]),d=Object(b.a)(u,2),h=d[0],m=d[1],j=Object(n.useState)(s),g=Object(b.a)(j,2),f=g[0],O=g[1],y=Object(n.useState)(r),x=Object(b.a)(y,2),_=x[0],k=x[1],S=Object(n.useState)("form-control"),w=Object(b.a)(S,2),N=w[0],C=w[1],I=Object(n.useState)("form-control"),A=Object(b.a)(I,2),F=A[0],q=A[1],E=Object(n.useState)(""),T=Object(b.a)(E,2),R=T[0],B=T[1];return window.facetSearchFunctions[a+"_clearSliderValue"]=function(){m([s,r]),O(s),k(r),C("form-control"),q("form-control"),B("")},Object(v.jsxs)("div",{id:c,children:[Object(v.jsx)("div",{className:"col-sm-11",style:{paddingBottom:"20px","white-space":"nowrap"},children:Object(v.jsx)(p.a.Range,{min:s,max:r,step:o,onChange:function(e){m([e[0],e[1]]),f!=e[0]&&O(Math.round(e[0])),_!=e[1]&&k(Math.round(e[1]))},defaultValue:h,value:h})}),Object(v.jsxs)("div",{className:"form-group row",children:[Object(v.jsx)("div",{className:"col-sm-5",children:Object(v.jsx)("input",{type:"number",id:c+"_input_head",className:N,value:f,onChange:function(e){return O(e.target.value)}})}),Object(v.jsx)("div",{className:"col-sm-5",children:Object(v.jsx)("input",{type:"number",id:c+"_input_tail",className:F,value:_,onChange:function(e){return k(e.target.value)}})}),Object(v.jsx)("div",{className:"col-sm-2",children:Object(v.jsx)("button",{type:"button",style:{marginLeft:"3px"},className:"btn btn-primary pull-right",onClick:function(){(function(){var e=document.getElementById(c+"_input_head"),t=document.getElementById(c+"_input_tail");if(document.getElementById(c+"_msg"),!e.value||!t.value)return e.value||C("form-control range-slider-error"),t.value||q("form-control range-slider-error"),B("Set the value."),!1;var a=new RegExp(/^([1-9]\d*|0)$/),n=a.exec(f),l=a.exec(_);return null==n||n[0]!=f||null==l||l[0]!=_?(null!=n&&n[0]==f||C("form-control range-slider-error"),null!=l&&l[0]==_||q("form-control range-slider-error"),B("Set the correct value."),!1):parseFloat(f)>parseFloat(_)?(C("form-control range-slider-error"),q("form-control range-slider-error"),B("The range from should be less than or equal to the range to."),!1):(C("form-control"),q("form-control"),B(""),!0)})()&&(l.set(a,f+"--"+_),"0"===l.get("q")&&l.set("q",""),l.set("is_facet_search","true"),window.invenioSearchFunctions.reSearchInvenio(l))},children:" \u691c\u7d22"})})]}),Object(v.jsx)("div",{className:"range-slider-error-msg",id:c+"_msg",children:R})]})},O=a(1),y=a(2);var x=function(e){var t=e.values,a=e.name,c=e.labels,l=e.displayNumber,s=Object(n.useState)({}),r=Object(b.a)(s,2),i=r[0],o=r[1],u="id_"+a+"_chkbox",d=CSS.escape(u),h=function(e){var t=e.id,a=e.value,n=e.checked,c=e.onChange;return null!=c?(i[t]=n,Object(v.jsx)("input",{id:t,className:"facet-chbox",type:"checkbox",checked:i[t],onChange:c,value:a})):Object(v.jsx)("input",{id:t,className:"facet-chbox",type:"checkbox",defaultChecked:n,value:a})},m=function(e){var t=e.values,a=e.name,n=e.isModal,c=e.displayNumber,l=e.onChange;return t.map((function(e,t){if(n||t<c){var s="id_"+a+(n?"_chkbox_mdl_":"_chkbox_")+t,r=e.key+"("+e.doc_count+")",i=x.get(a)&&x.getAll(a).includes(e.key);return Object(v.jsx)("div",{children:Object(v.jsxs)("label",{htmlFor:s,children:[Object(v.jsx)(h,{id:s,value:e.key,checked:i,onChange:l},s),r]})},s)}}))},j=function(e){var t=e.values,a=e.name,n=e.modalId;return Object(v.jsxs)("div",{className:"chbox-mdl",id:n,children:[Object(v.jsx)("a",{className:"overlay",onClick:g,modalId:n}),Object(v.jsx)("div",{className:"window",children:Object(v.jsxs)("div",{className:"content",children:[Object(v.jsx)("div",{className:"list",children:Object(v.jsx)(m,{values:t,name:a,isModal:!0})}),Object(v.jsxs)("div",{className:"footer",children:[Object(v.jsx)("a",{onClick:g,modalId:n,children:c.cancel}),Object(v.jsx)("button",{type:"button",className:"btn btn-primary",onClick:p,modalId:n,children:c.search})]})]})})]},n)};function g(e){null!=e&&document.getElementById(e.target.getAttribute("modalId")).classList.remove("is-active")}function p(e){var t=[];document.querySelector("#"+d).querySelectorAll(".chbox-mdl input").forEach((function(e){e.checked?t.push({label:a,value:e.value}):i[e.id]&&o(Object(y.a)(Object(y.a)({},i),{},Object(O.a)({},e.id,e.checked)))})),f(t),document.getElementById(e.target.getAttribute("modalId")).classList.remove("is-active")}function f(e){x.delete(a),e.map((function(e,t){x.append(a,e.value)})),"0"===x.get("q")&&x.set("q",""),x.set("is_facet_search","true"),window.invenioSearchFunctions.reSearchInvenio(x)}var x=new URLSearchParams(window.location.search),_="id_"+a+"_checkbox_modal",k=null==l?5:l;return Object(v.jsx)("div",{id:u,children:Object(v.jsxs)("div",{className:"chbox-container",children:[Object(v.jsx)(m,{values:t,name:a,isModal:!1,displayNumber:k,onChange:function(e){var t=[];document.querySelector("#"+d).querySelectorAll(".chbox-mdl input").forEach((function(n){(n.checked&&e.target.value!==n.value||e.target.checked&&e.target.value===n.value)&&t.push({label:a,value:n.value})})),o(Object(y.a)(Object(y.a)({},i),{},Object(O.a)({},e.target.id,e.target.checked))),f(t)}}),t.length>k&&Object(v.jsx)("a",{onClick:function(e){null!=e?(document.getElementById(e.target.getAttribute("modalId")).classList.add("is-active"),document.querySelector("#"+d).querySelectorAll(".chbox-mdl input").forEach((function(e){e.checked=x.get(a)&&x.getAll(a).includes(e.value)}))):console.log("event == null")},modalId:_,children:". . . See More"}),Object(v.jsx)(j,{values:t,name:a,modalId:_,displayNumber:l})]})})};for(var _,k=function(e){var t=e.item,a=e.nameshow,c=e.name,l=e.key,s=e.labels,r=e.isInitOpen,i=e.uiType,o=e.displayNumber;console.debug("RangeFacet\u5b9f\u884c");var u=window.location.search.replace(",","%2C").indexOf(encodeURIComponent(c))>=0||r,d=Object(n.useState)(u),h=Object(b.a)(d,2),j=h[0],p=h[1];return Object(v.jsxs)("div",{className:"panel panel-default",children:[Object(v.jsxs)("div",{className:"panel-heading clearfix",children:[Object(v.jsx)("h3",{className:"panel-title pull-left",children:a}),Object(v.jsxs)("a",{className:"pull-right",onClick:function(){return p(!j)},children:[!j&&Object(v.jsx)("span",{children:Object(v.jsx)("i",{className:"glyphicon glyphicon-chevron-right"})}),j&&Object(v.jsx)("span",{children:Object(v.jsx)("i",{className:"glyphicon glyphicon-chevron-down"})})]})]}),Object(v.jsx)(m.a,{isOpen:j,children:Object(v.jsxs)("div",{className:"panel-body index-body",children:[null!=t&&"SelectBox"===i&&Object(v.jsx)(g,{values:t.buckets,name:c,labels:s}),null!=t&&"CheckboxList"===i&&Object(v.jsx)(x,{values:t.buckets,name:c,labels:s,displayNumber:o}),null!=t&&"RangeSlider"===i&&Object(v.jsx)(f,{value:t.buckets,name:c,labels:s})]})})]},l)},S={},w=document.getElementsByClassName("body-facet-search-label"),N=0;N<w.length;N++)S[w[N].id]=w[N].value;var C=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(r.a)(this,a),(n=t.call(this,e)).state={is_enable:!1,list_title:{},list_facet:{},list_order:{},list_uiType:{},list_isOpen:{},list_displayNumber:{}},n.getTitleAndOrder=n.getTitleAndOrder.bind(Object(o.a)(n)),n.get_facet_search_list=n.get_facet_search_list.bind(Object(o.a)(n)),n.convertData=n.convertData.bind(Object(o.a)(n)),_=Object(o.a)(n),n}return Object(i.a)(a,[{key:"getTitleAndOrder",value:function(){var e=this,t={},a={},n={},c={},l={};Object(h.a)("/facet-search/get-title-and-order",{method:"POST"}).then((function(e){return e.json()})).then((function(s){s.status&&(t=s.data.titles,a=s.data.order,n=s.data.uiTypes,c=s.data.isOpens,l=s.data.displayNumbers),e.setState({list_title:t}),e.setState({list_order:a}),e.setState({list_uiType:n}),e.setState({list_isOpen:c}),e.setState({list_displayNumber:l}),e.setState({is_enable:!0})}))}},{key:"get_facet_search_list",value:function(){var e=this,t=new URLSearchParams(window.location.search),a=2==t.get("search_type")?"/api/index/":"/api/records/";Object(h.a)(a+"?"+t.toString()).then((function(e){return e.json()})).then((function(a){if(2==t.get("search_type")){var n=a&&a.aggregations&&a.aggregations.aggregations?a.aggregations.aggregations[0]:{};e.convertData(n)}else e.convertData(a&&a.aggregations?a.aggregations:{})}))}},{key:"convertData",value:function(e){var t={};e&&Object.keys(e).map((function(a,n){var c=e[a][a]?e[a][a]:e[a],l=c.key&&c.key.hasOwnProperty("buckets");if(l=c.hasOwnProperty("buckets")||l){if(t[a]=c[a]?c[a]:c,"Time Period(s)"!=a&&"Data Language"!=a&&"Access"!=a)for(var s=document.getElementById("lang-code"),r=s.options[s.selectedIndex].value,i=t[a],o=0;o<i.buckets.length;o++){var u=i.buckets[o];("en"==r&&(u.key.charCodeAt(0)>256||u.key.charCodeAt(u.key.length-1)>256)||"en"!=r&&u.key.charCodeAt(0)<256&&u.key.charCodeAt(u.key.length-1)<256)&&(t[a].buckets.splice(o,1),o--)}if("Access"==a)for(var d=t[a],h=0;h<d.buckets.length;h++){var b=d.buckets[h];(b.key.charCodeAt(0)>256||b.key.charCodeAt(b.key.length-1)>256)&&(t[a].buckets.splice(h,1),h--)}}})),this.setState({list_facet:t}),Object.keys(e).map((function(e,t){window.facetSearchFunctions[e+"_clearSliderValue"]&&window.facetSearchFunctions[e+"_clearSliderValue"]()}))}},{key:"componentDidMount",value:function(){this.getTitleAndOrder(),this.get_facet_search_list()}},{key:"render",value:function(){var e=this.state,t=e.is_enable,a=e.list_title,n=e.list_facet,c=e.list_order,l=e.list_uiType,s=e.list_isOpen,r=e.list_displayNumber;return Object(v.jsx)("div",{children:t&&Object(v.jsx)("div",{className:"facet-search break-word",children:Object.keys(c).map((function(e,t){var i=c[e],o=n[i],u=a[i],d=s[i],h=l[i],b=r[i];return Object(v.jsx)(k,{item:o,nameshow:u,name:i,labels:S,isInitOpen:d,uiType:h,displayNumber:b},t)}))})})}}]),a}(c.a.Component);window.facetSearchFunctions={},window.facetSearchFunctions.useFacetSearch=function(){return null!=_},window.facetSearchFunctions.resetFacetData=function(e){null!=_&&_.convertData(e)};var I=C;s.a.render(Object(v.jsx)(c.a.StrictMode,{children:Object(v.jsx)(I,{})}),document.getElementById("app-facet-search"))}},[[72,1,2]]]);
//# sourceMappingURL=main.779191b7.chunk.js.map