{# -*- coding: utf-8 -*-
  #
  # This file is part of WEKO3.
  # Copyright (C) 2017 National Institute of Informatics.
  #
  # WEKO3 is free software; you can redistribute it
  # and/or modify it under the terms of the GNU General Public License as
  # published by the Free Software Foundation; either version 2 of the
  # License, or (at your option) any later version.
  #
  # WEKO3 is distributed in the hope that it will be
  # useful, but WITHOUT ANY WARRANTY; without even the implied warranty of
  # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
  # General Public License for more details.
  #
  # You should have received a copy of the GNU General Public License
  # along with WEKO3; if not, write to the
  # Free Software Foundation, Inc., 59 Temple Place, Suite 330, Boston,
  # MA 02111-1307, USA.
  #}


{%- extends admin_base_template %}

{%- block css %}
  {{ super() }}
 {% assets "weko_theme_css_buttons" %}<link href="{{ ASSET_URL }}" rel="stylesheet">{% endassets %}
 {% assets "weko_admin_css" %}<link href="{{ ASSET_URL }}" rel="stylesheet">{% endassets %}
 {% assets "weko_admin_date_picker_css" %}<link href="{{ ASSET_URL }}" rel="stylesheet">{% endassets %}
{%- endblock css %}

{%- block javascript %}
  {{ super() }}
  <!-- <script src="{{ url_for('static', filename='js/weko_admin/stats_report.js') }}"></script> -->
  {%- assets "weko_admin_stats_report_js" %}<script src="{{ ASSET_URL }}"></script>{% endassets %}
  {% assets "weko_admin_date_picker_js" %}<script type="text/javascript" src="{{ ASSET_URL }}"></script>{% endassets %}
  {% assets "weko_report_reactjs_lib" %}<script type="text/javascript" src="{{ ASSET_URL }}"></script>{% endassets %}
  {% assets "weko_admin_custom_report" %}<script type="text/babel" src="{{ ASSET_URL }}"></script>{% endassets %}
{%- endblock javascript %}

{%- block body %}
<div id="alerts"></div>
{% from "weko_theme/macros/modal_page.html" import all_modal %}
{{ all_modal() }}
<style>
  .content-font {
    font-size: 16px;
  }
</style>

<!-- Number of items registered -->
<div class="row content-font">
  <div class="col-md-1"></div>
  <div class="col-md-11 pull-left">
    <h4>{{_('Number of items registered')}}</h4>
  </div>
</div>

<div class="row content-font">
  <div class="col-md-2"></div>
  <div class="col-md-10">
    <label>{{_('Total number of items registered:')}}</label>
    &nbsp;&nbsp;&nbsp;
    {{ result.total if result.total else 0 }}
  </div>
</div>
<div class="row content-font">
  <div class="col-md-2"></div>
  <div class="col-md-10">
    <label>{{_('Number of open items registered:')}}</label>
    &nbsp;&nbsp;&nbsp;
    {{ result.open if result.open else 0 }}
  </div>
</div>
<div class="row content-font">
  <div class="col-md-2"></div>
  <div class="col-md-10">
    <label>{{_('Number of private items registered:')}}</label>
    &nbsp;&nbsp;&nbsp;
    {{ result.private if result.private else 0 }}
  </div>
</div>
<hr>

<div class="row content-font">
  <div class="col-md-1"></div>
  <div class="col-md-11 pull-left">
    <h4>{{_('File Preview Report')}}</h4>
  </div>
</div>

<div class="row content-font">
  <div class="col-md-2"></div>
  <div class="col-md-4">
    <label>{{_('Aggregation month')}}</label>
  </div>
</div>

<div class="row content-font">
  <div class="col-md-1"></div>
  <div class="col-md-11">
    <form method="POST" name="report_file_form" id="report_file_form"
      action={{url_for('report.get_file_stats_tsv')}}>
      <p class="col-xs-2 text-right">{{_('Type')}}</p>
      <div class="col-xs-2">
        <select class="form-control" id="report_type_select" name="type">
          <option value="all" selected>{{_('All')}}</option>
          <option value="file_download">{{ _("File Downloads") }}</option>
          <option value="file_preview">{{ _("File Previews") }}</option>
          <option value="index_access">{{ _("Index Access") }}</option>
          <option value="detail_view">{{ _("Item View") }}</option>
          <option value="file_using_per_user">{{ _("File Using Per User") }}</option>
          <option value="search_count">{{ _("Search Keyword") }}</option>
          <option value="top_page_access">{{ _("Top Page Access") }}</option>
        </select>
      </div>

      <p class="col-xs-1 text-right">{{_('Year')}}</p>
      <div class="col-xs-1">
        <select class="form-control" id="report_year_select" name="year">
          {% for x in range(5) %}
            {% set year = now.year - x %}
            {% if year == now.year %}
            <option value="{{ year }}" selected="selected">{{ year }}</option>
            {% else %}
            <option value="{{ year }}">{{ year }}</option>
            {% endif %}
          {% endfor %}
        </select>
      </div>

      <p class="col-xs-1 text-right">{{_('Month')}}</p>
      <div class="col-xs-1">
        <select class="form-control" id="report_month_select" name="month">
          {% for x in range(1, 13) %}
          {% set mon = '%02d' % x %}
          {% if x == now.month %}
          <option value="{{ x }}" selected="selected">{{ _('%(mon)s', mon=mon) }}</option>
          {% else %}
          <option value="{{ x }}">{{ _('%(mon)s', mon=mon) }}</option>
          {% endif %}
          {% endfor %}
        </select>
      </div>
      <input type="hidden" id="report_file_input" name="report" value="{}" />
    </form>
    <div class="col-xs-2">
      <button id="downloadReport" class="btn btn-primary action-big-button">
            <span class="glyphicon glyphicon-download-alt"></span>
                  {{_('Download')}}</button>
    </div>
  </div>
</div>
<hr>

<div id="root"></div>

<div class="modal fade" tabindex="-1" role="dialog" id="error_modal">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title">{{_('Error')}}</h4>
      </div>
      <div class="modal-body">
        <p class="text-center">{{_('Could not download file.')}}</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-info close-button" data-dismiss="modal">
              <span class="glyphicon glyphicon-remove"></span>
                 {{_('Close')}}
        </button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

{%- endblock body %}
