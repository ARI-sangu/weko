{#
  # This file is part of WEKO3.
  # Copyright (C) 2017 National Institute of Informatics.
  #
  # WEKO3 is free software; you can redistribute it
  # and/or modify it under the terms of the GNU General Public License as
  # published by the Free Software Foundation; either version 2 of the
  # License, or (at your option) any later version.
  #
  # WEKO3 is distributed in the hope that it will be
  # useful, but WITHOUT ANY WARRANTY; without even the implied warranty of
  # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
  # General Public License for more details.
  #
  # You should have received a copy of the GNU General Public License
  # along with WEKO3; if not, write to the
  # Free Software Foundation, Inc., 59 Temple Place, Suite 330, Boston,
  # MA 02111-1307, USA.
  #}
  
  {%- extends admin_base_template %}
  
  {%- block css %}
  {{ super() }}
  {%- endblock css %}
  
  {%- block javascript %}
  {{ super() }}
  <script src="https://unpkg.com/react@16/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@16/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.38/browser.min.js"></script>
  <script type="text/babel">
  class Component_Select_Field extends React.Component {
      constructor(props) {
          super(props);
          this.state = {
              repositoryId: '0',
              selectOptions: []
          };
          this.styleRed = {
              color: 'red',
          };
          this.handleChange = this.handleChange.bind(this);
      }
  
      componentDidMount() {
          fetch(this.props.url_request)
              .then(res => res.json())
              .then(
                  (result) => {
                      let options = result.options.map((option) => {
                          return (
                              <option key={option.value} value={option.value}>{option.text}</option>
                          )
                      });
                      this.setState({
                          selectOptions: options
                      });
                  },
  
                  (error) => {
                      this.setState({
                          isLoaded: true,
                          error
                      });
                  }
              )
  
      }
  
      handleChange(event) {
          this.setState({ repositoryId: event.target.value });
          this.props.getValueOfField(event.target.value);
          event.preventDefault();
      }
  
      render() {
          return (
              <div className="form-group row">
                  <label htmlFor="input_type" className="control-label col-xs-2 text-right">{this.props.name}<span style={this.styleRed}>*</span></label>
                  <div class="controls col-xs-5">
                      <select value={this.state.repositoryId} onChange={this.handleChange} className="form-control">
                          <option value="0">Please selected the input type</option>
                          {this.state.selectOptions}
                      </select>
                  </div>
              </div>
          )
      }
  }

  class Component_Textbox_Field extends React.Component {
      constructor(props) {
          super(props);
          this.styleRed = {
              color: 'red',
          };
          this.handleChange = this.handleChange.bind(this);
      }
  
      handleChange(event) {
          this.setState({ repositoryId: event.target.value });
          this.props.getValueOfField(event.target.value);
          event.preventDefault();
      }
  
      render() {
          return (
              <div className="form-group row">
                <label htmlFor="input_type" className="control-label col-xs-2 text-right">{this.props.name}<span style={this.styleRed}>*</span></label>
                <div class="controls col-xs-5">
                  <input type="text" name="name" onChange={this.handleChange} className="form-control"/>
                </div>
              </div>
          )
      }  
  }

  class Component_Select_Color_Filed extends React.Component {
      constructor(props) {
          super(props);
          this.state = {
            color : '#4169E1',
          };
          this.handleChange = this.handleChange.bind(this);
      }
  
      handleChange(event) {
          this.setState({ color: event.target.value });
          this.props.getValueOfField(event.target.value);
          event.preventDefault();
      }
  
      render() {
          return (
              <div className="form-group row">
                  <label htmlFor="input_type" className="control-label col-xs-2 text-right">{this.props.name}</label>
                  <div className="controls col-xs-2">
                    <input  type="color" name="favcolor" value={this.state.color} onChange={this.handleChange}/>
                  </div>
              </div>
          )
      } 
  }

  class Component_Checkbox_Field extends React.Component {
      constructor(props) {
          super(props);
          this.handleChange = this.handleChange.bind(this);
      }
  
      handleChange(event) {
          this.setState({ repositoryId: event.target.value });
          this.props.getValueOfField(event.target.value);
          event.preventDefault();
      }
  
      render() {
          return (
              <div className="form-group row">
                  <label htmlFor="input_type" className="control-label col-xs-2 text-right">{this.props.name}</label>
                  <div class="controls col-xs-1">
                      <input type="checkbox" name="FrameBorder" value="" checked/>
                  </div>
              </div>
          )
      } 
  }

  class Component_Field_Contain_Select_Mutiple extends React.Component {
      constructor(props) {
          super(props);
          this.state = {
              selectOptions: [],
              UnauthorizedOptions: [],
              unauthorList: []
          };
          this.styleContainer={
            border: '1px solid #ccc',
            height: '200px',
            padding :'15px 5px 5px 10px',
          }
          this.styleElement={
            padding: "0",
          }
          this.styleSelectLeft={
            padding: "0",
            width: "90%",
            height: "100px",
            float: "left",
          }
          this.styleSelectRight={
            padding: "0",
            width: "90%",
            height: "100px",
            float: "right",
          }
          this.styleButtonContainer = {
            display: 'flex',
            flexDirection : 'column',
            justifyContent: 'center', 
            height: "100px",
          }
          this.styleButtonElement={
            margin: "2px",
          }
          this.handleChange = this.handleChange.bind(this);
          this.handleMoveRightClick = this.handleMoveRightClick.bind(this);
          this.handleMoveLeftClick = this.handleMoveLeftClick.bind(this);
          this.onSelect = this.onSelect.bind(this);
      }
      componentDidMount() {
          fetch(this.props.url_request)
              .then(res => res.json())
              .then(
                  (result) => {
                      let options = result.map((option) => {
                          return (
                              <option key={option.id} value={option.id}>{option.name}</option>
                          )
                      });
                      this.setState({
                          selectOptions: options
                      });
                  },
  
                  (error) => {
                      this.setState({
                          isLoaded: true,
                          error
                      });
                  }
              )
  
      }
  
      handleChange(event) {
          this.setState({ repositoryId: event.target.value });
          this.props.getValueOfField(event.target.value);
          event.preventDefault();
      }

      getListOption(id) {
        let options = document.getElementById(id).options;
        let result = [];
        for (let option in options) {
            if (options[option].value) {
                let innerhtml = <option key={options[option].value} value={options[option].value}>{options[option].text}</option>;
                result.push(innerhtml);
            }
        }
        return result;
      }

      isValueExist(item, array) {
          if (array == undefined) {
              return true;
          }
          if (array.length != 0) {
            for (let prop in array) {
                if (array[prop].props.value == item) {
                    return true;
                }else {
                    return false;
                }
            }
          } else {
              return false;
          }
          return true;
      }

      handleMoveRightClick(event) {
          let options = document.getElementById("BrowsingAuthorized").options;
          let selectedOptions = this.getListOption("BrowsingUnauthorized");
          let nonSelectOptions = [];
          for (let option in options) {
              if (options[option].selected) {
                    let innerhtml = <option key={options[option].value} value={options[option].value}>{options[option].text}</option>;
                    if (!this.isValueExist(options[option].value, selectedOptions) && options[option].value){
                        selectedOptions.push(innerhtml);
                    }
              }else {
                let innerhtml = <option key={options[option].value} value={options[option].value}>{options[option].text}</option>;
                nonSelectOptions.push(innerhtml);
              }
          }
            this.setState({
                selectOptions: nonSelectOptions,
                UnauthorizedOptions: selectedOptions
            });
      }

      handleMoveLeftClick(event) {
          let selectedIndex = this.state.unauthorList;
          let options = this.getListOption("BrowsingUnauthorized");
          let authorizedOptions = this.getListOption("BrowsingAuthorized");
          let remainOption = [];
          for (let option in options) {
            let registed = false;
              for (let index in selectedIndex) {
                  if (options[option].key == selectedIndex[index]) {
                    let innerhtml = <option key={options[option].props.value} value={options[option].props.value}>{options[option].props.children}</option>;
                    if (!this.isValueExist(options[option].props.value), authorizedOptions) {
                        authorizedOptions.push(innerhtml);
                    }
                    registed = true;
                    break;
                  }
              }
              if (!registed) {
                let innerhtml = <option key={options[option].props.value} value={options[option].props.value}>{options[option].props.children}</option>;
                remainOption.push(innerhtml);
              }
          }
          this.setState({
            selectOptions: authorizedOptions,
            UnauthorizedOptions: remainOption
          });
      }

      onSelect(event) {
        var options = event.target.options;
        var value = [];
        for (var i = 0, l = options.length; i < l; i++) {
            if (options[i].selected) {
                value.push(options[i].value);
            }
        }
        this.setState({
            unauthorList: value
        });
      }

      render() {
          return (
              <div className="form-group row">
                  <label htmlFor="input_type" className="control-label col-xs-2 text-right">{this.props.name}</label>
                  <div class="controls col-xs-5">
                      <fieldset className="form-group" style={this.styleContainer}>
                      <label>Role </label><br/>
                      <div className="col-xs-5" style={this.styleElement}>
                        <label >Authorized</label><br/>
                        <select multiple style={this.styleSelectLeft} id="BrowsingAuthorized">
                            {this.state.selectOptions}
                        </select>
                      </div>
                      <div className="col-xs-1" style={this.styleElement}>
                        <br/>
                        <div className="buttons" style={this.styleButtonContainer}>
                          <input type="button" value="&rarr;" style={this.styleButtonElement} onClick={this.handleMoveRightClick}/>
                          <input type="button" value="&larr;" style={this.styleButtonElement} onClick={this.handleMoveLeftClick}/>
                        </div>
                      </div>
                      <div className="col-xs-5" style={this.styleElement}>
                        <label >Unauthorized</label><br/>
                        <select multiple value={this.state.unauthorList} style={this.styleSelectRight} onChange={this.onSelect} id="BrowsingUnauthorized">
                            {this.state.UnauthorizedOptions}
                        </select>
                      </div>
                      </fieldset>
                  </div>
              </div>
          )
      } 
  }
  
  class Component_Button_Layout extends React.Component {
    constructor(props) {
        super(props);
        this.style = {
            marginLeft: "10px",
        };
    }
    render() {
        return (
            <div className="form-group col-xs-10">
                <div className="col-xs-2"> </div>
                <div className="col-xs-5">
                  <button className="btn btn-primary">Save</button>
                  <button className="form-group btn btn-danger" style={this.style}>Cancel</button>
                </div>
            </div>
        )
    }
  }

  class MainLayout extends React.Component {
      constructor(props) {
          super(props);
          this.state = {
              repositoryId: '',
          };
          this.style = {
              "width": ""
          }
          this.getValueOfField = this.getValueOfField.bind(this);
      }
  
      getValueOfField(repositoryId) {
          console.log(repositoryId);
          this.setState({ repositoryId: repositoryId });
      }
  
      render() {
          return (
              <div>
                  <div className="row">
                      <Component_Select_Field getValueOfField={this.getValueOfField} name="Repository" url_request="/api/autofill/select_options" />
                  </div>
                  <div className="row">
                      <Component_Select_Field getValueOfField={this.getValueOfField} name="Type" url_request="/api/admin/load_widget_type"/>
                  </div>
                  <div className="row">
                      <Component_Textbox_Field getValueOfField={this.getValueOfField} name="Label" url_request="/api/autofill/select_options"/>
                  </div>
                  <div className="row">
                    <Component_Select_Color_Filed getValueOfField={this.getValueOfField} name="Label Color" />
                  </div>
                  <div className="row">
                    <Component_Checkbox_Field name="Frame Border" />
                  </div>
                  <div className="row">
                    <Component_Select_Color_Filed getValueOfField={this.getValueOfField} name="Frame Border Color" />
                  </div>
                  <div className="row">
                    <Component_Select_Color_Filed getValueOfField={this.getValueOfField} name="Text Color" />
                  </div>
                  <div className="row">
                    <Component_Select_Color_Filed getValueOfField={this.getValueOfField} name="Background Color" />
                  </div>
                  <div className="row">
                    <Component_Field_Contain_Select_Mutiple getValueOfField={this.getValueOfField} name="Browsing Privilege" url_request="/api/admin//get_account_role"/>
                  </div>
                  <div className="row">
                    <Component_Field_Contain_Select_Mutiple getValueOfField={this.getValueOfField} name="Edit Privilege" url_request="/api/admin//get_account_role"/>
                  </div>
                  <div className="row">
                    <Component_Checkbox_Field name="Enable" />
                  </div>
                  <div className="row">
                    <Component_Button_Layout />
                </div>
              </div>
          )
      }
  }
  
  ReactDOM.render(
      <MainLayout />,
      document.getElementById('root')
  )
  </script>
  {%- endblock javascript %}
  
  {%- block body %}
  <div id="root" class="col-xs-12"></div>
  {% endblock %}
  