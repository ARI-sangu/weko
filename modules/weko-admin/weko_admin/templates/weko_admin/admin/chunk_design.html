{#
# This file is part of WEKO3.
# Copyright (C) 2017 National Institute of Informatics.
#
# WEKO3 is free software; you can redistribute it
# and/or modify it under the terms of the GNU General Public License as
# published by the Free Software Foundation; either version 2 of the
# License, or (at your option) any later version.
#
# WEKO3 is distributed in the hope that it will be
# useful, but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
# General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with WEKO3; if not, write to the
# Free Software Foundation, Inc., 59 Temple Place, Suite 330, Boston,
# MA 02111-1307, USA.
#}

{%- extends admin_base_template %}

{%- block css %}
{{ super() }}
{%- endblock css %}

{%- block javascript %}
{{ super() }}
<script src="https://unpkg.com/react@16/umd/react.production.min.js" crossorigin></script>
<script src="https://unpkg.com/react-dom@16/umd/react-dom.production.min.js" crossorigin></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.38/browser.min.js"></script>
<script type="text/babel">
class Repository extends React.Component {
    constructor(props) {
        super(props);
        this.state = {
            repositoryId: '0',
            selectOptions: []
        };
        this.styleRed = {
            color: 'red',
        };
        this.handleChange = this.handleChange.bind(this);
    }

    componentDidMount() {
        fetch("/api/autofill/select_options")
            .then(res => res.json())
            .then(
                (result) => {
                    let options = result.options.map((option) => {
                        return (
                            <option key={option.value} value={option.value}>{option.text}</option>
                        )
                    });
                    this.setState({
                        selectOptions: options
                    });
                },

                (error) => {
                    this.setState({
                        isLoaded: true,
                        error
                    });
                }
            )

    }

    handleChange(event) {
        this.setState({ repositoryId: event.target.value });
        this.props.getRepositoryId(event.target.value);
        event.preventDefault();
    }

    render() {
        return (
            <div className="form-group row">
                <label htmlFor="input_type" className="control-label col-xs-1">Repository<span style={this.styleRed}>*</span></label>
                <div class="controls col-xs-5">
                    <select value={this.state.repositoryId} onChange={this.handleChange} className="form-control">
                        <option value="0">Please selected the input type</option>
                        {this.state.selectOptions}
                    </select>
                </div>
            </div>
        )
    }

}

class ChunkList extends React.Component {
    constructor(props) {
        super(props);
        this.style = {
            "border": "1px solid #eee",
            "min-height": "200px",
            "height": "80%",
            "padding": "5px",
            "overflow": "scroll",
            "overflow-x": "hidden",
            "margin-right": "0px"
        };
    }

    render() {
        return (
            <div>
                <label className="control-label row">Chunk List</label>
                <div className="controls row" style={this.style}>

                </div>
            </div>
        )
    }
}

class PreviewChunk extends React.Component {
    constructor(props) {
        super(props);
        this.style = {
            "border": "1px solid #eee",
            "min-height": "200px",
            "height": "80%",
            "padding": "15px"
        };
    }

    render() {
        return (
            <div>
                <label className="control-label row">Preview</label>
                <div className="controls row" style={this.style}>

                </div>
            </div>
        )
    }

}

class ButtonLayout extends React.Component {
    constructor(props) {
        super(props);
        this.style = {
            "margin-right": "10px",
            "margin-left": "-15px"

        };
    }
    render() {
        return (
            <div className="form-group col-xs-10">
                <button className="btn btn-primary" style={this.style}>Save</button>
                <button className="form-group btn btn-danger">Cancel</button>
            </div>
        )
    }
}

class MainLayout extends React.Component {
    constructor(props) {
        super(props);
        this.state = {
            repositoryId: '',
        };
        this.style = {
            "width": ""
        }
        this.getRepositoryId = this.getRepositoryId.bind(this);
    }

    getRepositoryId(repositoryId) {
        console.log(repositoryId);
        this.setState({ repositoryId: repositoryId });
    }

    render() {
        return (
            <div>
                <div className="row">
                    <Repository getRepositoryId={this.getRepositoryId} />
                </div>
                <div className="row">
                    <div className="form-group col-xs-2">
                        <ChunkList />
                    </div>
                    <div className="form-group col-xs-10">
                        <PreviewChunk repositoryId={this.state.repositoryId} />
                    </div>
                </div>
                <div className="row">
                    <ButtonLayout />
                </div>
            </div>
        )
    }
}

ReactDOM.render(
    <MainLayout />,
    document.getElementById('root')
)
</script>
{%- endblock javascript %}

{%- block body %}
<div id="root" class="col-xs-12"></div>
{% endblock %}
